# TEST Y-lab

## API для управления меню ресторана

Это REST API, разработанное с использованием FastAPI, позволяет управлять меню ресторана,
включая блюда и подменю. Оно предоставляет функциональность для добавления, обновления и
удаления меню, подменю и блюд, а также получения информации о них.

### Предварительные требования

Убедитесь, что у вас установлены следующие инструменты и библиотеки:

- Python версии 3.10 или выше (приложение писалось на 3.12)
- FastAPI
- Uvicorn для запуска сервера
- SQLAlchemy для взаимодействия с базой данных
- PostgreSQL как основная система управления базами данных

## Установка

Для запуска проекта выполните следующие шаги:

- Клонируйте репозиторий проекта:

> https://github.com/MemphisAton/Test-lab.git

- Установите зависимости:
> pip install -r requirements.txt

- Создайте базу данных PostgreSQL.

- Настройте подключение к PostgreSQL.

В модуле database.py необходимо исправить строку:
> SQLALCHEMY_DATABASE_URL = "postgresql://USER:RASSWORD@localhost/DBNAME"

где:

- USER - user, который имеет доступ к бд
- RASSWORD - от учетки USERa
- DBNAME - имя бд, где будет созадны таблицы

Далее выполните миграции для создания таблиц:
> alembic upgrade head

- Запустите сервер разработки:
> uvicorn main:app --reload

## Использование

### Примеры использования API:

-Получение списка всех меню:
> GET /api/v1/menus

- Добавление нового меню:
> POST /api/v1/menus

Тело запроса:
> {
"title": "Название меню",
"description": "Описание"
> }

- Обновление существующего меню:
> PATCH /api/v1/menus/{menu_id}

### Реализация специального функционала:

***Вывод количества подменю и блюд для меню через один ORM запрос***

Для выполнения этой задачи была реализована функция:
>get_menu_with_counts

в файле 
>crud.py
 
*Эта функция использует сложный ORM запрос для получения количества подменю и блюд, 
связанных с каждым меню.*

## Разработка:

Проект состоит из нескольких основных модулей:

- **"models.py"** содержит модели SQLAlchemy для взаимодействия с базой данных.
- **"schemas.py"** определяет Pydantic схемы для валидации данных.
- **"crud.py"** содержит функции для выполнения CRUD-операций.
- **"main.py"** является точкой входа в приложение и содержит определения маршрутов FastAPI.

## Подготовка к тестированию:

1. Клонирование репозитория
> git clone https://github.com/MemphisAton/Test-lab.git

2. Перейдите в командной строке в каталог с проектом.
> cd <путь_к_проекту>

Если необходимо прогнать тесты локально, то установите зависимости и прописываем команду:
> pip install -r requirements.txt
 
>pytest -v (флаг -v для более подробного вывода)

3. Сборка образов Docker
> docker-compose build

Далее на выбор выполняется любое тестирование, они работают одновременно, так что все перезапускать необходимости нет.
### Тестирование (PyTest/Docker):

4. Запустите нужный контейнер, используя Docker Compose:
> docker-compose up test

Мы должны увидеть следующую информацию:
> ylab1-test-1  | tests/test_all_postman_.py .[  5%]
> 
> ylab1-test-1  | tests/test_dish.py ....     [ 29%]
> 
> ylab1-test-1  | tests/test_menu.py ........ [ 76%]
> 
> ylab1-test-1  | tests/test_submenu.py ....  [100%]

5. (не обязательно) Проверить статус запущенных контейнеров:
> docker-compose ps

6. Остановка и удаление контейнеров:
> docker-compose down

### Тестирование (Postman):

4. Запустите нужный контейнер, используя Docker Compose:
> docker-compose up api  

Далее в POSTMAN по сценарию:
- см. доп. материалы
- Нажимаем import *(1 на скрине)* и переносим 2 прикрепленных выше файла в окно постман.
  Один файл - коллекция тестов, второй - переменные окружения. В диалоговом окне подтверждаем импорт.
  После этого должна появиться коллекция *(подчернуто на скрине)* menu app. Выбираем переменные
  окружения *(2 на скрине)* из выпадающего списка. После этого можем зайти в коллекцию **menu app** и
  запустить каждый тест вручную. Для этого открываем коллекцию **menu app**, выбираем
  **Тестовый сценарий -> CRUD для меню -> Просматривает список меню(или любой другой)**
  у нас в центральной части появляется запрос, нажимаем **Send** и запрос летит в наше приложение.
  Если хотим запустит сразу всю коллекцию тестов, то жмем на три точки *(3 на скрине)* рядом с
  коллекцией и выбираем **Run**.
- Дополнительные материалы:
> https://drive.google.com/drive/folders/1PiT_hdhXMlpAnpz_yXBiiccRlLTOmBjF?usp=sharing

5. (не обязательно) Проверить статус запущенных контейнеров:
> docker-compose ps

6. Остановка и удаление контейнеров:
> docker-compose down

## Деплой:

Смотрите в следующей серии: "Docker, Docker-compose, Gunicorn & AWS EC2"

## Авторы:

- **Код писал**: @MemphisAton
- **Дал ТЗ**: сам бы поговорил с ним

## Лицензия:

Ёе нет, можете юзать и в хвост и в гриву.

## Благодарности:

Спасибо маме, папе и тому кто дал ТЗ.